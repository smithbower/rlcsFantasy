```{r, include=FALSE}
library(knitr)
library(kableExtra)
library(tidyverse)
source("simulateSeason.R")

p_week <- 3
p_run <- 500


p_teams_stephen <- read.csv("teams_stephen.csv", stringsAsFactors = FALSE)
```

---
title: `r paste("Stephen's RLCS Season 7 Fantasy League", '<br>', 'Week', p_week, "Report")`
output: html_notebook
---
Date published: April 16, 2019
<br><br>

Selected teams:<br>
```{r, include=FALSE, results='hide'}
## Run optimizer to find a team for this week.
stephen_lastTeam <- c(which(weeklyPlayerData[[p_week - 1]]$Player == as.character(p_teams_stephen[1,(p_week)])), 
                      which(weeklyPlayerData[[p_week - 1]]$Player == as.character(p_teams_stephen[2,(p_week)])), 
                      which(weeklyPlayerData[[p_week - 1]]$Player == as.character(p_teams_stephen[3,(p_week)])), 
                      which(weeklyPlayerData[[p_week - 1]]$Player == as.character(p_teams_stephen[4,(p_week)])),
                      which(weeklyPlayerData[[p_week - 1]]$Player == as.character(p_teams_stephen[5,(p_week)])), 
                      which(weeklyPlayerData[[p_week - 1]]$Player == as.character(p_teams_stephen[6,(p_week)]))) 
stephen_newTeam <- selectTeam(stephen_lastTeam, weeklyPlayerData[[p_week - 1]], p_run)
```

```{r, echo=FALSE}
## Prep new table showing old teams + optimized team for this week.
## Pull out the new team solution.
stephen_newTeam_names <- weeklyPlayerData[[p_week - 1]][floor(stephen_newTeam@solution[end(stephen_newTeam@solution)[1],]),]$Player
p_teams_stephen$Suggested <- c(stephen_newTeam_names,0)

p_teams_stephen <- rbind(p_teams_stephen, c("expected", c(1:(p_week+1))))

## Calculate the expected number of points for each week.
for (i in 1:p_week)
{
  team <- p_teams_stephen[1:6,(i + 1)]
  if (i == 1)
  {
    score <- round(estimateScore(teamNamesToIDs(team, playerScores), playerScores)) ## Use OG data for the first week estimation.
  }
  else
  {
    score <- round(estimateScore(teamNamesToIDs(team, weeklyPlayerData[[i - 1]]), weeklyPlayerData[[i - 1]]))
  }
  
  p_teams_stephen[8, (i + 1)] <- score
}

p_teams_stephen[8, p_week + 2] <- round(estimateScore(teamNamesToIDs(stephen_newTeam_names, weeklyPlayerData[[p_week - 1]]), weeklyPlayerData[[p_week - 1]]))


kable(subset(p_teams_stephen, select = c(1, rep(2:(p_week + 1)), ncol(p_teams_stephen))), caption="Stephen's Weekly Teams") %>% kable_styling
```
<br>


```{r, echo=FALSE}
## Pull in min, max, and average score for each week so we can plot it.

t_score <- c()
t_min <- c()
t_max <- c()
t_week <- c()

tj_type <- c("min", "max", "avg")

for (i in 1:p_week)
{
  team <- p_teams_stephen[1:6,(i + 1)]
  if (i == 1)
  {
    scores <- round(estimateScores(teamNamesToIDs(team, playerScores), playerScores)) ## Use OG data for the first week estimation.
  }
  else
  {
    scores <- round(estimateScores(teamNamesToIDs(team, weeklyPlayerData[[i - 1]]), weeklyPlayerData[[i - 1]]))
  }
  
  t_min <- c(t_min, scores[1])
  t_max <- c(t_max, scores[2])
  t_score <- c(t_score, scores[3])
  t_week <- c(t_week, i)

}

plotdf <- data.frame("score" = t_score, "min" = t_min, "max" = t_max, "week" = t_week)

ggplot(plotdf) + 
  geom_line(aes(week, score), group = 1) +
  scale_y_continuous(breaks = c(1:p_week)) +
  geom_ribbon(aes(x = week, ymax = max, ymin = min), alpha = 0.5)
  
```